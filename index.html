<!DOCTYPE html>

<html lang="en">
<html id="h">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pagina inicial</title>

    <!-- Fonts -->
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <!-- Fontawesome -->
    <link rel="stylesheet" type="text/css" href="fontawesome/css/fontawesome.css" />


    <!-- Style -->
    <link rel="stylesheet" type="text/css" href="css/style.css" />


</head>

<body id="h">

    <div class="container-ini">
        <div id="app">
            <main class="py-4">
                <div class="container">
                    <div class="col-md-12">
                        <p class="titulo_login_principal">Plantas de energ&iacute;a</p>
                        <p class="titulo_login_principal">Complejidad y optimizaci&oacute;n</p>
                        <section>
                            <span class="span_icon_form"></span>
                            <form id="form_optimizar">
                                <fieldset>
                                    <legend class="titulo_login">Bienvenidos</legend>
                                    <hr>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label for="plantas">Plantas nucleares:*</label>
                                                <select multiple class="form-control" id="plantas" name="plantas[]" required>
                                                    <option value="Nuclear" selected>Nuclear</option>
                                                    <option value="Hidroelectrica" selected>Hidroelectrica</option>
                                                    <option value="Termica" selected>Termica</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <hr/>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="planta_producciones">Agregar producciones:</label>
                                            <div style="display: flex; justify-content: space-between;">
                                                <div class="col-md-5">
                                                    <div class="input-group mb-3">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text" id="basic-addon1">
                                                                <i class="fa fa-lightbulb"></i>
                                                            </span>
                                                        </div>
                                                        <select class="form-control" id="planta_producciones">
                                                            <option value="Nuclear" >Nuclear</option>
                                                            <option value="Hidroelectrica" >Hidroelectrica</option>
                                                            <option value="Termica" >Termica</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-5">
                                                    <div class="input-group mb-3">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text" id="basic-addon1">
                                                                <i class="fa fa-bolt"></i>
                                                            </span>
                                                        </div>
                                                        <input type="text" class="form-control" id="mwxdia">
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <button type="button" class="btn btn-primary" onclick="addMwXDia()">
                                                        <i class="fa fa-paper-plane"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="contact_name">Listado de producciones de mw en un día:*</label>
                                            <div style="margin-top: 10px;">
                                                <table class="table" id="table_mwxdia">
                                                    <thead>
                                                        <tr>
                                                            <th>Planta</th>
                                                            <th>Producción mw por un día</th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>

                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <hr/>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="phone_numbers">Agregar costos:</label>
                                            <div style="display: flex; justify-content: space-between;">
                                                <div class="col-md-5">
                                                    <div class="input-group mb-3">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text" id="basic-addon1">
                                                                <i class="fa fa-lightbulb"></i>
                                                            </span>
                                                        </div>
                                                        <select class="form-control" id="planta_costo">
                                                            <option value="Nuclear" >Nuclear</option>
                                                            <option value="Hidroelectrica" >Hidroelectrica</option>
                                                            <option value="Termica" >Termica</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-5">
                                                    <div class="input-group mb-3">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text" id="basic-addon1">
                                                                <i class="fa fa-dollar-sign"></i>
                                                            </span>
                                                        </div>
                                                        <input type="text" class="form-control" id="costo">
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <button type="button" class="btn btn-primary" onclick="addCosto()">
                                                        <i class="fa fa-paper-plane"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="contact_name">Listado de costos:*</label>
                                            <div style="margin-top: 10px;">
                                                <table class="table" id="table_costo">
                                                    <thead>
                                                        <tr>
                                                            <th>Planta</th>
                                                            <th>Costo</th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>

                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <hr/>
                                </fieldset>


                                <fieldset>
                                    <legend>Tabla Demanda</legend>
                                    <hr>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="cant_clientes">Cantidad de clientes:*</label>
                                                <input type="number" class="form-control" id="cant_clientes" name="cant_clientes" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="cant_dias">Cantidad de dias:*</label>
                                                <input type="number" class="form-control" id="cant_dias" name="cant_dias" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="clientes">Clientes:</label>
                                                <select class="form-control" id="clientes">
                                                    <option value="">Seleccione un cliente</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="dias">Dias:</label>
                                                <select class="form-control" id="dias">
                                                    <option value="">Seleccione un dia</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="cant_mw">MW:*</label>
                                                <input type="number" class="form-control" id="cant_mw">
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <button type="button" class="btn btn-primary" onclick="addDemanda()">
                                                    <i class="fa fa-paper-plane"></i>
                                                </button>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label for="contact_name">Demanda</label>
                                            <div style="margin-top: 10px;">
                                                <table class="table" id="table_costo_demanda">
                                                    <thead>
                                                    </thead>
                                                    <tbody>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>

                                <p><button type="button" class="boton_login" id="optimizar">Optimizar</button></p>
                                <input type="hidden" name="modulo" value="Optimizar">
                            </form>
                        </section>
                    </div>
                </div>
            </main>
        </div>

        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

        <!-- Fontawesome -->
        <script src="fontawesome/js/all.js"></script>

        <!-- Sweetalert2 -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

        <script src="https://code.jquery.com/jquery-3.5.0.js"></script>

        <script>
            let lineNo = 0;
            let lineNoMwXDia = 0;

            function addMwXDia() {

                var planta_producciones = $("#planta_producciones").val();
                var mwxdia = $("#mwxdia").val();

                if (lineNoMwXDia == 3) {
                    Swal.fire({
                        icon: 'info',
                        title: 'Oops...',
                        text: 'Solo se puede ingresar la cantidad de mw por un dia para cada planta!',
                    });
                } else {
                    if (planta_producciones != "" && mwxdia != "") {
                        lineNoMwXDia++;
                        var markup = "<tr id='item_" + lineNoMwXDia + "'><td>" + planta_producciones + " <input type='hidden' name='producciones[" + planta_producciones + "]' value='" + mwxdia + "'></td> <td>" + mwxdia + "</td> <td> <button type=\"button\" class=\"btn btn-danger\" onclick=\"removeMwXDia('item_" + lineNoMwXDia + "')\"><i class=\"fa fa-window-close\"></i> </button></td></tr>";
                        var tableBody = $("#table_mwxdia tbody");
                        tableBody.append(markup);
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Debe seleccionar una planta e indicar la cantidad de mw que produce por un dia!',
                        });
                    }
                }
            }

            function addCosto() {
                console.log($("#planta_costo").val());

                var planta = $("#planta_costo").val();
                var costo = $("#costo").val();

                if (lineNo == 3) {
                    Swal.fire({
                        icon: 'info',
                        title: 'Oops...',
                        text: 'Solo se puede ingresar un costo por cada planta!',
                    });
                } else {
                    if (planta != "" && costo != "") {
                        lineNo++;
                        var markup = "<tr id='item_" + lineNo + "'><td>" + planta + " <input type='hidden' name='costos[" + planta + "]' value='" + costo + "'></td> <td>" + costo + "</td> <td> <button type=\"button\" class=\"btn btn-danger\" onclick=\"removeCosto('item_" + lineNo + "')\"><i class=\"fa fa-window-close\"></i> </button></td></tr>";
                        var tableBody = $("#table_costo tbody");
                        tableBody.append(markup);
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Debe seleccionar una planta e indicar el costo!',
                        });
                    }
                }
            }

            function removeMwXDia(elemt) {
                lineNoMwXDia--;
                $('#' + elemt).fadeOut('slow', function() {
                    $('#' + elemt).remove();
                });
            }

            function removeCosto(elemt) {
                console.log("removeCosto");
                lineNo--;
                $('#' + elemt).fadeOut('slow', function() {
                    $('#' + elemt).remove();
                });
            }

            $(document).ready(function() {

                $("#cant_clientes").keyup(function() {

                    var cant_dias = $("#cant_dias").val();
                    var cant_clientes = $(this).val();
                    if (cant_clientes > 0) {
                        //Rellenar select cliente
                        var html_select = "";
                        for (var i = 1; i <= cant_clientes; i++) {
                            var detail_cliente = "Cliente" + i;
                            html_select += "<option value='" + detail_cliente + "' selected>" + detail_cliente + "</option>";
                        }
                        $("#clientes").html(html_select);

                        construirTabla(cant_clientes, cant_dias);
                    }
                });

                $("#cant_dias").keyup(function() {

                    var cant_dias = $(this).val();
                    var cant_clientes = $("#cant_clientes").val();
                    if (cant_dias > 0) {
                        //Rellenar select dias
                        var html_select = "";
                        for (var a = 1; a <= cant_dias; a++) {
                            var detail_dia = "Dia" + a;
                            html_select += "<option value='" + detail_dia + "' selected>" + detail_dia + "</option>";
                        }
                        $("#dias").html(html_select);

                        construirTabla(cant_clientes, cant_dias);
                    }

                });

                //Petición
                $("#optimizar").click(function() {

                    var producciones = $("#table_mwxdia tbody").children().length;
                    var costos = $("#table_costo tbody").children().length;
                    var demanda = $("#table_costo_demanda tbody").children().length;
                    var cantidad_clientes = $("#cant_clientes").val();
                    var cantidad_dias = $("#cant_dias").val();

                    if (producciones <= 0 || producciones < $("#plantas").children().length) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Debe ingresar todos las porducciones de mw que se hace en un día por cada planta!',
                        });
                    } else if (costos <= 0 || costos < $("#plantas").children().length) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Debe ingresar todos los costos por 1 MW de cada planta!',
                        });
                    } else if (cantidad_clientes == "" || cantidad_clientes == 0) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Debe ingresar la cantidad de clientes y debe ser mayo a 0!',
                        });
                    } else if (cantidad_dias == "" || cantidad_dias == 0) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Debe ingresar la cantidad de dias y debe ser mayo a 0!',
                        });
                    } else if (demanda <= 0) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Debe registrar todas las según el dia por cliente!',
                        });
                    } else {

                        $.ajax({
                            type: 'POST',
                            url: 'optimizar.php',
                            data: $('#form_optimizar').serialize(),
                            dataType: 'json',
                            success: function(data) {
                                var html = "<div class='overflow-auto'><ul class='list-group'>";
                                for (var i = 0; i < data.data.length; i++) {
                                    html += "<li class='list-group-item'>" + data.data[i] + "</li>";
                                }
                                html += "</ul></div>";

                                Swal.fire({
                                    icon: 'info',
                                    title: 'Resultado!' + data.mensaje,
                                    html: html,
                                });
                            },
                            error: function(data) {
                                console.log('ERROR AJAX: ' + data);
                            }
                        });

                    }

                });
            });

            function construirTabla(cant_clientes, cant_dias) {

                var tableHead = $("#table_costo_demanda thead");
                var tableBody = $("#table_costo_demanda tbody");

                if (cant_clientes > 0 && cant_dias > 0) {

                    tableHead.html("");
                    tableBody.html("");
                    //Head Table
                    var html = "<tr><th>Cliente</th>";
                    for (var i = 1; i <= cant_dias; ++i) {
                        html += "<th>Dia" + i + "</th>";
                    }
                    html += "</tr>";
                    tableHead.html(html);

                    //Body Table
                    var htm_body = "";
                    for (var i = 1; i <= cant_clientes; ++i) {
                        htm_body += "<tr><td>Cliente" + i + "</td>";
                        for (var d = 1; d <= cant_dias; d++) {
                            htm_body += "<td><span id='Cliente" + i + "_Dia" + d + "'></span> <input type='hidden' id='Cliente" + i + "_Dia" + d + "_value' name='demanda[cliente" + i + "][dia" + d + "]' value='0'></td>";
                        }
                        htm_body += "</tr>";
                    }
                    tableBody.html(htm_body);

                } else {
                    tableHead.html("");
                    tableBody.html("");
                }

            }

            function addDemanda() {
                console.log("addDemanda");
                var cliente = $("#clientes").val();
                var dia = $("#dias").val();
                var mw = $("#cant_mw").val();

                if (cliente != "" && dia != "" && mw != "") {

                    $("#" + cliente + "_" + dia + "_value").val(mw);
                    console.log("#" + cliente + "_" + dia);
                    $("#" + cliente + "_" + dia).html(mw);

                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Debe seleccionar el cliente, el dia he ingresar la cantidad de mega watts!',
                    });
                }

            }
        </script>
    </div>

</body>

</html>